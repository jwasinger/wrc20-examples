defaults:
    create_build_dir: &create_build_dir
        run:
            name: "create build directory"
            command: |
                mkdir build

    build_c_example: &build_c_example
        run:
            name: "Build C Example"
            command: |
                # docker run -v $(pwd)/src/C:/C -t jwasinger/clang-7 bash -c "cd /C && make"
                # C contracts need remap-exports support in chisel so skip building C wrc20 during CI
                cp src/C/wrc20.wasm build/c.wasm

    truffle: &truffle
        run:
            name: "run tests with truffle"
            command: |
                bash scripts/test_erc20.sh

version: 2
jobs:
    build:
        machine: true
        steps:
            - checkout
            - *create_build_dir
            - *build_c_example
            - *truffle
